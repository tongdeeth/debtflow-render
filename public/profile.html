<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>โปรไฟล์ - DebtFriend</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, sans-serif; padding: 20px; background: linear-gradient(135deg, #1E3A8A, #3B82F6); margin: 0; padding-bottom: 80px; color: white; }
        h1 { font-size: 24px; margin-bottom: 20px; }
        .section { background: rgba(255, 255, 255, 0.1); backdrop-filter: blur(10px); padding: 15px; border-radius: 15px; margin-bottom: 15px; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2); }
        .alert { background: #F87171; color: white; padding: 10px; border-radius: 10px; margin-bottom: 15px; }
        .action-btn { background: #3B82F6; color: white; padding: 10px; border: none; border-radius: 15px; cursor: pointer; width: 100%; margin-top: 10px; }
        .action-btn:hover { background: #1E3A8A; }
        .nav-bar { position: fixed; bottom: 0; left: 0; width: 100%; background: rgba(255, 255, 255, 0.1); backdrop-filter: blur(10px); display: flex; justify-content: space-around; padding: 10px 0; box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.2); border-top-left-radius: 15px; border-top-right-radius: 15px; z-index: 1000; }
        .nav-bar a { text-align: center; color: #666; text-decoration: none; font-size: 12px; }
        .nav-bar a.active { color: #3B82F6; }
        .nav-bar i { display: block; margin: 0 auto 5px; font-size: 24px; }
        .profile-pic { width: 100px; height: 100px; border-radius: 50%; object-fit: cover; margin-bottom: 10px; }
        .stars { color: #FBBF24; margin: 5px 0; }
    </style>
</head>
<body>
    <h1>โปรไฟล์ - DebtFriend</h1>

    <!-- Dispute Alert -->
    <div class="alert" id="disputeAlert" style="display: none;">
        <i class="fas fa-exclamation-circle"></i> มีการโต้แย้ง: งาน #<span id="disputedTask"></span>
    </div>

    <!-- Profile Picture -->
    <div class="section">
        <h2>Profile Picture</h2>
        <img id="profilePic" src="https://res.cloudinary.com/demo/image/upload/v1312461204/sample.jpg" alt="Profile Picture" class="profile-pic">
        <input type="file" id="profilePicInput" accept="image/*" style="display: none;" onchange="updateProfilePic(event)">
        <button class="action-btn" onclick="document.getElementById('profilePicInput').click()">เปลี่ยนรูปโปรไฟล์</button>
    </div>

    <!-- Profile Details -->
    <div class="section">
        <h2>ข้อมูลส่วนตัว</h2>
        <p>ชื่อ: <span id="userName"></span></p>
        <p>ระดับ: <span id="userLevel" class="stars"></span></p>
    </div>

    <!-- Team Details -->
    <div class="section">
        <h2>ข้อมูลทีม</h2>
        <p>ทีม: <span id="userTeam"></span></p>
        <p>สาขา: <span id="userBranch"></span></p>
    </div>

    <!-- Navigation Bar -->
    <div class="nav-bar">
        <a href="dashboard.html"><i class="fas fa-home"></i> หน้าแรก</a>
        <a href="tasks.html"><i class="fas fa-briefcase"></i> งาน</a>
        <a href="income.html"><i class="fas fa-wallet"></i> รายได้</a>
        <a href="performance.html"><i class="fas fa-chart-line"></i> ผลงาน</a>
        <a href="profile.html" class="active"><i class="fas fa-user-circle"></i> โปรไฟล์</a>
    </div>

    <script>
        const currentUser = JSON.parse(localStorage.getItem('currentUser')) || {};
        const incomeData = JSON.parse(localStorage.getItem('incomeData')) || [];

        // Display user details
        document.getElementById('userName').textContent = currentUser.name || 'ไม่ระบุ';
        document.getElementById('userTeam').textContent = currentUser.team || 'ไม่ระบุ';
        document.getElementById('userBranch').textContent = currentUser.branch || 'ไม่ระบุ';
        document.getElementById('userLevel').textContent = '★'.repeat(currentUser.level || 0);

        // Load profile picture from localStorage if available
        const savedPic = localStorage.getItem('profilePic');
        if (savedPic) {
            document.getElementById('profilePic').src = savedPic;
        }

        // Update profile picture
        function updateProfilePic(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const imgData = e.target.result;
                    document.getElementById('profilePic').src = imgData;
                    localStorage.setItem('profilePic', imgData);
                };
                reader.readAsDataURL(file);
            }
        }

        // Check for disputes in income data
        const disputedTask = incomeData.find(item => item.comment);
        if (disputedTask) {
            document.getElementById('disputeAlert').style.display = 'block';
            document.getElementById('disputedTask').textContent = disputedTask.contract;
        }
    </script>
</body>
</html>
